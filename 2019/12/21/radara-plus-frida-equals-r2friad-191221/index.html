<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="前言 演示例子:   Sina Weibo Xiao Hongshu  参考资料: r2wiki、enovella wiki  正文0x1 安装首先安装radare2，Windows用户可以在这里下载可执行文件安装 然后安装r2frida，自行克隆安装 用frida-ls-devices工具获取 usb device id   接着用frida-ps -U | grep xhs获取完整包名 然后根">
<meta name="keywords" content="frida,r2frida,radare2">
<meta property="og:type" content="article">
<meta property="og:title" content="RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool">
<meta property="og:url" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/index.html">
<meta property="og:site_name" content="0x2h">
<meta property="og:description" content="前言 演示例子:   Sina Weibo Xiao Hongshu  参考资料: r2wiki、enovella wiki  正文0x1 安装首先安装radare2，Windows用户可以在这里下载可执行文件安装 然后安装r2frida，自行克隆安装 用frida-ls-devices工具获取 usb device id   接着用frida-ps -U | grep xhs获取完整包名 然后根">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/frida_ls_devices.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_java_newCalculateS_01.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_newCalculateS.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_getOriginalString.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_getKeyString.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_getIndex.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_sub_451c.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/frida_mbedtls_decode_output.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/mbedtls_des_crypt_ecb_doc.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/mbedtls_des_setkey_dec_doc.png">
<meta property="og:updated_time" content="2019-12-21T11:52:34.746Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool">
<meta name="twitter:description" content="前言 演示例子:   Sina Weibo Xiao Hongshu  参考资料: r2wiki、enovella wiki  正文0x1 安装首先安装radare2，Windows用户可以在这里下载可执行文件安装 然后安装r2frida，自行克隆安装 用frida-ls-devices工具获取 usb device id   接着用frida-ps -U | grep xhs获取完整包名 然后根">
<meta name="twitter:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/frida_ls_devices.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2019/12/03/dy-end-191203/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&text=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&is_video=false&description=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&body=Check out this article: http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&name=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#正文"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-安装"><span class="toc-number">2.1.</span> <span class="toc-text">0x1 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-使用"><span class="toc-number">2.2.</span> <span class="toc-text">0x2 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-1-gt-help"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">0x2.1&gt; help</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-2-gt-dm"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">0x2.2&gt; dm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-3-gt-iE"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">0x2.3&gt; iE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-24-gt"><span class="toc-number">2.2.0.4.</span> <span class="toc-text">0x.24&gt; \/</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-Dynamic"><span class="toc-number">2.3.</span> <span class="toc-text">0x3 Dynamic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x3-1-gt-dma"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">0x3.1&gt; dma</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-gt-dtf-trace-function-from-address"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.2&gt; dtf (trace function from address)</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#0x4-Memory"><span class="toc-number">3.</span> <span class="toc-text">0x4 Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-1-getOriginalString"><span class="toc-number">3.1.</span> <span class="toc-text">0x4.1 getOriginalString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-2-getKeyString"><span class="toc-number">3.2.</span> <span class="toc-text">0x4.2 getKeyString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-3-getIndex"><span class="toc-number">3.3.</span> <span class="toc-text">0x4.3 getIndex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-4-g-pin、g-from"><span class="toc-number">3.4.</span> <span class="toc-text">0x4.4 g_pin、g_from</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-5-sub-451C"><span class="toc-number">3.5.</span> <span class="toc-text">0x4.5 sub_451C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x5-算法还原"><span class="toc-number">4.</span> <span class="toc-text">0x5 算法还原</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">4.0.1.</span> <span class="toc-text">Java:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Golang"><span class="toc-number">4.0.2.</span> <span class="toc-text">Golang:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-（sha512-h太长了，直接去github下载把）"><span class="toc-number">4.0.3.</span> <span class="toc-text">C++（sha512.h太长了，直接去github下载把）:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">4.0.4.</span> <span class="toc-text">Python:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最后"><span class="toc-number">5.</span> <span class="toc-text">最后</span></a></li>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">0x2h</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-12-21T09:11:23.000Z" itemprop="datePublished">2019-12-21</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/frida/">frida</a>, <a class="tag-link" href="/tags/r2frida/">r2frida</a>, <a class="tag-link" href="/tags/radare2/">radare2</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>演示例子: </p>
<ul>
<li>Sina Weibo</li>
<li>Xiao Hongshu</li>
</ul>
<p>参考资料: <a href="https://r2wiki.readthedocs.io/en/latest/radare-plugins/frida/" target="_blank" rel="noopener">r2wiki</a>、<a href="https://github.com/enovella/r2frida-wiki" target="_blank" rel="noopener">enovella wiki</a></p>
</blockquote>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="0x1-安装"><a href="#0x1-安装" class="headerlink" title="0x1 安装"></a>0x1 安装</h2><p>首先安装<a href="https://github.com/radareorg/radare2" target="_blank" rel="noopener">radare2</a>，Windows用户可以在这里<a href="https://radare.mikelloc.com/list" target="_blank" rel="noopener">下载</a>可执行文件安装</p>
<p>然后安装<a href="https://github.com/nowsecure/r2frida" target="_blank" rel="noopener">r2frida</a>，自行克隆安装</p>
<p>用<code>frida-ls-devices</code>工具获取 <code>usb device id</code> </p>
<p><img src="images/frida_ls_devices.png" alt=""></p>
<p>接着用<code>frida-ps -U | grep xhs</code>获取完整包名</p>
<p>然后根据<code>id</code>和<code>package name</code>用<code>radare</code>连接<code>frida</code>:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r2 frida://c0e668cc/com.xingin.xhs</span><br></pre></td></tr></table></figure></p>
<p>然后你会得到一个r2dare的交互模式<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">❯ r2 frida://c0e668cc/com.xingin.xhs</span><br><span class="line">WARNING: r_bin_open_buf: assertion '(st64)opt-&gt;sz &gt;= 0' failed (line 250)</span><br><span class="line"> -- SSAbotage from ISIL</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="0x2-使用"><a href="#0x2-使用" class="headerlink" title="0x2 使用"></a>0x2 使用</h2><h4 id="0x2-1-gt-help"><a href="#0x2-1-gt-help" class="headerlink" title="0x2.1&gt; help"></a>0x2.1&gt; help</h4><p>首先介绍怎么使用<code>help</code>；对了，要使用<code>r2frida</code>的命令，得在命令的前面加上 <code>\</code> 或 <code>=!</code>；比如获取<code>help</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> =!? or \?</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> =!?</span><br><span class="line">r2frida commands available via =! or \ prefix</span><br><span class="line">. script                   Run script</span><br><span class="line">  frida-expression         Run given expression inside the agent</span><br><span class="line">/[x][j] &lt;string|hexpairs&gt;  Search hex/string pattern in memory ranges (see search.in=?)</span><br><span class="line">/v[1248][j] value          Search for a value honoring `e cfg.bigendian` of given width</span><br><span class="line">/w[j] string               Search wide string</span><br><span class="line">&lt;space&gt; code..             Evaluate Cycript code</span><br><span class="line">?                          Show this help</span><br><span class="line">?V                         Show target Frida version</span><br><span class="line">chcon file                 Change SELinux context (dl might require this)</span><br><span class="line">d.                         Start the chrome tools debugger</span><br><span class="line">db (&lt;addr&gt;|&lt;sym&gt;)          List or place breakpoint</span><br><span class="line">db- (&lt;addr&gt;|&lt;sym&gt;)|*       Remove breakpoint(s)</span><br><span class="line">dc                         Continue breakpoints or resume a spawned process</span><br><span class="line">dd[j-][fd] ([newfd])       List, dup2 or close filedescriptors (ddj for JSON)</span><br><span class="line">di[0,1,-1] [addr]          Intercept and replace return value of address</span><br><span class="line">dk ([pid]) [sig]           Send specific signal to specific pid in the remote system</span><br><span class="line">dkr                        Print the crash report (if the app has crashed)</span><br><span class="line">dl libname                 Dlopen a library (Android see chcon)</span><br><span class="line">dl2 libname [main]         Inject library using Frida's &gt;= 8.2 new API</span><br><span class="line">dm[.|j|*]                  Show memory regions</span><br><span class="line">dma &lt;size&gt;                 Allocate &lt;size&gt; bytes on the heap, address is returned</span><br><span class="line">... 有点长</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这是获取所有命令的帮助，如果想要获取某个字母有哪些命令只需要在其后面加 <code>?</code> 即可</p>
</blockquote>
<p>例如我想知道<code>i</code>字母开头的有哪些命令，都是干嘛的<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \i?</span><br><span class="line"> i	dump info</span><br><span class="line"> i*	dump info r2</span><br><span class="line"> iAE	list all exports</span><br><span class="line"> iAE*	list all exports r2</span><br><span class="line"> iAEj	list all exports json</span><br><span class="line"> iAn	list all classes natives</span><br><span class="line"> iAs	list all symbols</span><br><span class="line"> iAs*	list all symbols r2</span><br><span class="line"> iAsj	list all symbols json</span><br><span class="line"> iE	list exports</span><br><span class="line"> iE*	list exports r2</span><br><span class="line"> iE.	lookup symbol here</span><br><span class="line"> iEa	lookup export</span><br><span class="line"> iEa*	lookup export r2</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure></p>
<h4 id="0x2-2-gt-dm"><a href="#0x2-2-gt-dm" class="headerlink" title="0x2.2&gt; dm"></a>0x2.2&gt; dm</h4><p>简单介绍下常用命令。首先是获取so的信息命令 <strong><code>dm</code></strong>，比如地址。这里用到的<code>匹配符~</code>，这个符号类似grep命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dm~shield</span><br><span class="line">0xc5a1a000 - 0xc5a95000 r-x /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line">0xc5a95000 - 0xc5a99000 r-- /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line">0xc5a99000 - 0xc5a9a000 rw- /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>你也可以以radare的格式输出，只需要在命令后面加个 <strong><code>*</code></strong> 符号<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dm*~shield</span><br><span class="line">f map.0xc5a1a000 = 0xc5a1a000 # r-x /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line">f map.0xc5a95000 = 0xc5a95000 # r-- /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line">f map.0xc5a99000 = 0xc5a99000 # rw- /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br></pre></td></tr></table></figure></p>
<p>然后呢，如果你想更方便的把获取到的数据直接使用，可以输出为json格式，只需要在命令后面加<code>j</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dmj~shield</span><br><span class="line">Do you want to print 1 lines? (y/N) y</span><br><span class="line">[&#123;"base":"0x12c00000","size":3145728,"protection":"rw-","file":&#123;"path":"/dev/ashmem/dalvik-main space (region space) (deleted)","offset":0,"size":0&#125;&#125;,&#123;"base":"0x12f00000","size":4456448,"protection":"---","file":&#123;"path":"/dev/ashmem/dalvik-main space (region space) (deleted)","offset":3145728,"size":0&#125;&#125;,&#123;"base":"0x13340000","size":262144,"protection":"rw-","file":&#123;"path":"/dev/ashmem/dalvik-main space (region space) (deleted)","offset":7602176,"size":0&#125;&#125;,&#123;"base":"0x13380000","size":262144,"protection":"---","file":&#123;"path":"/dev/ashmem/dalvik-main space (region space) (deleted)",...</span><br></pre></td></tr></table></figure></p>
<h4 id="0x2-3-gt-iE"><a href="#0x2-3-gt-iE" class="headerlink" title="0x2.3&gt; iE"></a>0x2.3&gt; iE</h4><p>然后是获取so文件的所有导出函数命令 <strong><code>iE</code></strong>，应该是 <code>info exports</code> （我猜的<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \iE* libshield.so</span><br><span class="line">f sym.fun._Znaj = 0xc5a3f8b5</span><br><span class="line">f sym.fun._ZdaPv = 0xc5a3e579</span><br><span class="line">f sym.fun._ZdlPv = 0xc5a3e575</span><br><span class="line">f sym.fun.__cxa_begin_catch = 0xc5a3ebd5</span><br><span class="line">f sym.fun._ZSt9terminatev = 0xc5a3f4bd</span><br><span class="line">f sym.fun._Znwj = 0xc5a3f861</span><br><span class="line">f sym.var._ZTVN10__cxxabiv117__class_type_infoE = 0xc5a97290</span><br><span class="line">f sym.fun.JNI_OnLoad = 0xc5a257a9</span><br><span class="line">f sym.fun.__cxa_allocate_exception = 0xc5a3e655</span><br><span class="line">f sym.fun.__cxa_throw = 0xc5a3f571</span><br><span class="line">f sym.fun.__cxa_free_exception = 0xc5a3e6fd</span><br><span class="line">f sym.fun.__cxa_rethrow = 0xc5a3f5f1</span><br><span class="line">f sym.fun.__cxa_end_catch = 0xc5a3ec65</span><br><span class="line">f sym.var._ZSt7nothrow = 0xc5a94138</span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEE5clearEv = 0xc5a36c99</span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEE16_M_insert_uniqueISsEESt4pairISt17_Rb_tree_iteratorISsEbEOT_ = 0xc5a36d3d</span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEE4findERKSs = 0xc5a38701</span><br><span class="line">f sym.fun._ZNSt6vectorISsSaISsEED2Ev = 0xc5a2df71</span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEED2Ev = 0xc5a36f11</span><br><span class="line">f sym.fun._ZNSt6vectorISsSaISsEE7reserveEj = 0xc5a32455</span><br><span class="line">f sym.fun._ZNSt6vectorISsSaISsEE19_M_emplace_back_auxIJSsEEEvDpOT_ = 0xc5a39361</span><br><span class="line">f sym.fun.__cxa_guard_acquire = 0xc5a3f665</span><br><span class="line">f sym.fun.__cxa_guard_release = 0xc5a3f7dd</span><br><span class="line">f sym.fun._ZNSt9exceptionD2Ev = 0xc5a3ed01</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h4 id="0x-24-gt"><a href="#0x-24-gt" class="headerlink" title="0x.24&gt; \/"></a>0x.24&gt; \/</h4><p>搜索内存中的数据 <strong><code>\/</code></strong>；首先看看help<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \?~^/</span><br><span class="line">/[x][j] &lt;string|hexpairs&gt;  Search hex/string pattern in memory ranges (see search.in=?)</span><br><span class="line">/v[1248][j] value          Search for a value honoring `e cfg.bigendian` of given width</span><br><span class="line">/w[j] string               Search wide string</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>基础使用方法：<strong>\/ keyword</strong></p>
</blockquote>
<p>比如我要搜索…..emmmmmm：<strong><code>TracerPid</code></strong>；首先是一顿输出，然后会出现找到的个数，比如这里的12个，然后对应着地址和内容<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \/ TracerPid</span><br><span class="line">Searching 9 bytes: 54 72 61 63 65 72 50 69 64</span><br><span class="line">Searching 9 bytes in [0x12c00000-0x15180000]</span><br><span class="line">Searching 9 bytes in [0x151c0000-0x155c0000]</span><br><span class="line">Searching 9 bytes in [0x15640000-0x15680000]</span><br><span class="line">...</span><br><span class="line">Searching 9 bytes in [0xff508000-0xffd07000]</span><br><span class="line">Searching 9 bytes in [0xffff0000-0xffff1000]</span><br><span class="line">hits: 12</span><br><span class="line">0x14626d48 hit0_0 TracerPid:</span><br><span class="line">0xab1108f4 hit0_1 TracerPid:</span><br><span class="line">0xc2972232 hit0_2 TracerPid:</span><br><span class="line">0xc4c1e76c hit0_3 TracerPid</span><br><span class="line">0xc5aa7810 hit0_4 TracerPid:0</span><br><span class="line">0xc5ab2da8 hit0_5 TracerPid</span><br><span class="line">0xc8eb9c5e hit0_6 TracerPid:0Uid:10185101851018510185Gid:10185101851</span><br><span class="line">0xcb15818c hit0_7 TracerPid:</span><br><span class="line">0xd21ff45e hit0_8 TracerPid:0Uid:10185101851018510185Gid:10185101851</span><br><span class="line">0xd21ff85e hit0_9 TracerPid:0Uid:10185101851018510185Gid:10185101851</span><br><span class="line">0xd277b892 hit0_10 TracerPid:</span><br><span class="line">0xdf57105d hit0_11 TracerPid:0Uid:10185101851018510185Gid:10185101851</span><br><span class="line"></span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>为了验证我刚刚所说的，直接看内存，正好可以教用一个字母看内存数据，这个命令是radare的命令，这就是交互的好处。为了更好的凸显数据，我选择的是比较长的那个字符串，地址是：<code>0xc8eb9c5e</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> x @ 0xc8eb9c5e</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xc8eb9c5e  5472 6163 6572 5069 643a 0930 0a55 6964  TracerPid:.0.Uid</span><br><span class="line">0xc8eb9c6e  3a09 3130 3138 3509 3130 3138 3509 3130  :.10185.10185.10</span><br><span class="line">0xc8eb9c7e  3138 3509 3130 3138 350a 4769 643a 0931  185.10185.Gid:.1</span><br><span class="line">0xc8eb9c8e  3031 3835 0931 3031 3835 0931 3031 3835  0185.10185.10185</span><br><span class="line">0xc8eb9c9e  0931 3031 3835 0a46 4453 697a 653a 0935  .10185.FDSize:.5</span><br><span class="line">0xc8eb9cae  3132 0a47 726f 7570 733a 0933 3030 3320  12.Groups:.3003</span><br><span class="line">0xc8eb9cbe  3939 3937 2032 3031 3835 2035 3031 3835  9997 20185 50185</span><br><span class="line">0xc8eb9cce  2039 3939 3039 3939 3720 0a56 6d50 6561   99909997 .VmPea</span><br><span class="line">0xc8eb9cde  6b3a 0920 3234 3131 3832 3020 6b42 0a56  k:. 2411820 kB.V</span><br><span class="line">0xc8eb9cee  6d53 697a 653a 0920 3233 3439 3730 3820  mSize:. 2349708</span><br><span class="line">0xc8eb9cfe  6b42 0a56 6d4c 636b 3a09 2020 2020 2031  kB.VmLck:.     1</span><br><span class="line">0xc8eb9d0e  3136 206b 420a 566d 5069 6e3a 0920 2020  16 kB.VmPin:.</span><br><span class="line">0xc8eb9d1e  2020 2020 3020 6b42 0a56 6d48 574d 3a09      0 kB.VmHWM:.</span><br><span class="line">0xc8eb9d2e  2020 3637 3539 3336 206b 420a 566d 5253    675936 kB.VmRS</span><br><span class="line">0xc8eb9d3e  533a 0920 2035 3636 3431 3620 6b42 0a52  S:.  566416 kB.R</span><br><span class="line">0xc8eb9d4e  7373 416e 6f6e 3a09 2020 3130 3630 3136  ssAnon:.  106016</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><code>x</code> 是 <code>px</code> 命令的简写，这个命令作用是<code>show hexdump</code>。从上面可以明确的看到字符串；还可以用<code>ps</code> 命令直接输出pretty的字符串，当然得事先知道指定的地址内容存的是字符串，不然返回的就不知道是一堆啥玩意儿了，使用方法和<code>px</code>差不多<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> ps @ 0xc8eb9c5e</span><br><span class="line">TracerPid:\x090</span><br><span class="line">Uid:\x0910185\x0910185\x0910185\x0910185</span><br><span class="line">Gid:\x0910185\x0910185\x0910185\x0910185</span><br><span class="line">FDSize:\x09512</span><br><span class="line">Groups:\x093003 9997 20185 50185 99909997</span><br><span class="line">VmPeak:\x09 2411820 kB</span><br><span class="line">VmSize:\x09 2358724 kB</span><br><span class="line">VmLck:\x09     116 kB</span><br><span class="line">VmPin:\x09       0 kB</span><br><span class="line">VmHWM:\x09  675936 kB</span><br><span class="line">VmRSS:\x09  522464 kB</span><br><span class="line">RssAnon:\x09  100820</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里用json格式输出就很舒服了<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> psj @ 0xc8eb9c5e</span><br><span class="line">&#123;"string":"TracerPid:\u00090\u000aUid:\u000910185\u000910185\u000910185\u000910185\u000aGid:\u000910185\u000910185\u000910185\u000910185\u000aFDSize:\u0009512\u000aGroups:\u00093003 9997 20185 50185 99909997 \u000aVmPeak:\u0009 2411820 kB\u000aVmSize:\u0009 2253264 kB\u000aVmLck:\u0009     116 kB\u000aVmPin:\u0009       0 kB\u000aVmHWM:\u0009  675936 kB\u000aVmRSS:\u0009   84988 kB\u000aRssAnon:\u0009       0","offset":3370884190,"section":"unknown","length":256,"type":"ascii"&#125;</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>搜索也可以指定搜索的数据类型以及输出的格式，比如以十六进制搜索输出json格式的结果<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \/xj 547261636572506964</span><br><span class="line">Searching 9 bytes: 54 72 61 63 65 72 50 69 64</span><br><span class="line">Searching 9 bytes in [0x12c00000-0x12d80000]</span><br><span class="line">Searching 9 bytes in [0x12f80000-0x12fc0000]</span><br><span class="line">Searching 9 bytes in [0x13000000-0x13040000]</span><br><span class="line">Searching 9 bytes in [0x13340000-0x13380000]</span><br><span class="line">...</span><br><span class="line">Searching 9 bytes in [0xffff0000-0xffff1000]</span><br><span class="line">hits: 12</span><br><span class="line">[&#123;"address":"0x13033778","size":9,"flag":"hit2_0","content":"547261636572506964"&#125;,&#123;"address":"0xab1108f4","size":9,"flag":"hit2_1","content":"547261636572506964"&#125;,&#123;"address":"0xc2972232","size":9,"flag":"hit2_2","content":"547261636572506964"&#125;,&#123;"address":"0xc4c1e76c","size":9,"flag":"hit2_3","content":"547261636572506964"&#125;,&#123;"address":"0xc5aa7810","size":9,"flag":"hit2_4","content":"547261636572506964"&#125;,&#123;"address":"0xc5ab2da8","size":9,"flag":"hit2_5","content":"547261636572506964"&#125;,&#123;"address":"0xc8eb9c5e","size":9,"flag":"hit2_6","content":"547261636572506964"&#125;,&#123;"address":"0xcb15818c","size":9,"flag":"hit2_7","content":"547261636572506964"&#125;,&#123;"address":"0xd21ff45e","size":9,"flag":"hit2_8","content":"547261636572506964"&#125;,&#123;"address":"0xd21ff85e","size":9,"flag":"hit2_9","content":"547261636572506964"&#125;,&#123;"address":"0xd277b892","size":9,"flag":"hit2_10","content":"547261636572506964"&#125;,&#123;"address":"0xdf57105d","size":9,"flag":"hit2_11","content":"547261636572506964"&#125;]</span><br></pre></td></tr></table></figure></p>
<h2 id="0x3-Dynamic"><a href="#0x3-Dynamic" class="headerlink" title="0x3 Dynamic"></a>0x3 Dynamic</h2><p>这个功能特别牛逼，啊不，应该说<code>radare+frida</code>在这方法特别牛逼，所以我要单独拿出来做一个大块说。</p>
<p>首先看help<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \d?</span><br><span class="line"> db	breakpoint</span><br><span class="line"> db-	breakpoint unset</span><br><span class="line"> dbj	breakpoint json</span><br><span class="line"> dc	breakpoint continue</span><br><span class="line"> dcu	breakpoint continue until</span><br><span class="line"> dd	list file descriptors</span><br><span class="line"> dd-	close file descriptors</span><br><span class="line"> ddj	list file descriptors json</span><br><span class="line"> di	intercept help</span><br><span class="line"> di-1	intercept ret_1</span><br><span class="line"> di0	intercept ret0</span><br><span class="line"> di1	intercept ret1</span><br><span class="line"> dis	intercept ret string</span><br><span class="line"> dk	send signal</span><br><span class="line"> dl	dlopen</span><br><span class="line"> dm	list memory ranges</span><br><span class="line"> dm*	list memory ranges r2</span><br><span class="line"> dm.	list memory ranges here</span><br><span class="line"> dma	alloc size</span><br><span class="line"> dma-	remove alloc</span><br><span class="line"> dmad	alloc dup</span><br><span class="line"> dmal	list allocs</span><br><span class="line"> dmas	alloc string</span><br><span class="line"> dmh	list malloc ranges</span><br><span class="line"> dmh*	list malloc ranges r2</span><br><span class="line"> dmhj	list malloc ranges json</span><br><span class="line"> dmhm	list malloc maps</span><br><span class="line"> dmj	list memory ranges json</span><br><span class="line"> dmm	list memory maps</span><br><span class="line"> dmm.	list memory ranges here</span><br><span class="line"> dmp	change memory protection</span><br><span class="line"> dp	get pid</span><br><span class="line"> dpj	get pid json</span><br><span class="line"> dpt	list threads</span><br><span class="line"> dptj	list threads json</span><br><span class="line"> dr	dump registers</span><br><span class="line"> dr*	dump registers r2</span><br><span class="line"> dr8	dump register arena</span><br><span class="line"> drj	dump registers json</span><br><span class="line"> drp	dump register profile</span><br><span class="line"> drr	dump registers recursively</span><br><span class="line"> dt	trace</span><br><span class="line"> dt*	trace r2</span><br><span class="line"> dt-	clear trace</span><br><span class="line"> dt-*	clear all trace</span><br><span class="line"> dt.	trace here</span><br><span class="line"> dtf	trace format</span><br><span class="line"> dth	trace hook</span><br><span class="line"> dtj	trace json</span><br><span class="line"> dtl	trace log dump</span><br><span class="line"> dtl*	trace log dump r2</span><br><span class="line"> dtl-	trace log clear</span><br><span class="line"> dtl-*	trace log clear all</span><br><span class="line"> dtlj	trace log dump json</span><br><span class="line"> dtlq	trace log dump quiet</span><br><span class="line"> dtq	trace quiet</span><br><span class="line"> dtr	trace regs</span><br><span class="line"> dts	stalk trace everything</span><br><span class="line"> dts*	stalk trace everything r2</span><br><span class="line"> dts?	stalk trace everything help</span><br><span class="line"> dtsf	stalk trace function</span><br><span class="line"> dtsf*	stalk trace function r2</span><br><span class="line"> dtsfj	stalk trace function json</span><br><span class="line"> dtsj	stalk trace everything json</span><br><span class="line"> dxc	dx call</span><br><span class="line"></span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>我挑几个我用的最频繁的命令，因为是在太多了。。。<strong><code>dm</code></strong> 上面已经用过了就不说了</p>
</blockquote>
<p>说一下和 <strong><code>dm</code></strong> 在字母个数方面差不了多少的命令 <strong><code>dma</code></strong>，这个命令是分配内存大小用的。可以看它的详细help<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dma?</span><br><span class="line"> dma	alloc size</span><br><span class="line"> dma-	remove alloc</span><br><span class="line"> dmad	alloc dup</span><br><span class="line"> dmal	list allocs</span><br><span class="line"> dmas	alloc string</span><br><span class="line"></span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong><code>dma</code></strong> 分配内存大小 \<br><strong><code>dma-</code></strong> 删除所有分配的内存 \<br><strong><code>dmad</code></strong> … 没用过，翻译是重复分配 \<br><strong><code>dmal</code></strong> 列出所有分配的内存的地址 \<br><strong><code>dmas</code></strong> 分配字符串</p>
</blockquote>
<h4 id="0x3-1-gt-dma"><a href="#0x3-1-gt-dma" class="headerlink" title="0x3.1&gt; dma"></a>0x3.1&gt; dma</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dma 10</span><br><span class="line">0xc09622b8</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> x @ 0xc09622b8</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xc09622b8  0000 0000 0000 0000 0000 0000 c300 0000  ................</span><br><span class="line">0xc09622c8  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc09622d8  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc09622e8  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc09622f8  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962308  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962318  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962328  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962338  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962348  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962358  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962368  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xc0962378  0000 0000 0000 0000 0000 0000 d901 0000  ................</span><br><span class="line">0xc0962388  d0dd 4ed1 9873 95c0 102c dbc3 e0e1 4ed1  ..N..s...,....N.</span><br><span class="line">0xc0962398  3c01 afc5 0100 0000 0000 0000 0000 0000  &lt;...............</span><br><span class="line">0xc09623a8  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure>
<p>分配字符串<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dmas hellworld</span><br><span class="line">0xc3db1648</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> ps @ 0xc3db1648</span><br><span class="line">hellworld</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> x @ 0xc3db1648</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xc3db1648  6865 6c6c 776f 726c 6400 0000 1300 0000  hellworld.......</span><br><span class="line">0xc3db1658  6847 e7da 000d 2f0e 5016 dbc3 1b00 0000  hG..../.P.......</span><br><span class="line">0xc3db1668  7847 e7da 580b a702 0100 0000 9801 0d34  xG..X..........4</span><br><span class="line">0xc3db1678  1800 0000 1300 0000 3ce8 dfb6 7465 7200  ........&lt;...ter.</span><br><span class="line">0xc3db1688  6500 0000 1300 0000 10f8 e6da 7465 7200  e...........ter.</span><br><span class="line">0xc3db1698  246f dab6 1300 0000 3ce8 dfb6 3ce8 dfb6  $o......&lt;...&lt;...</span><br><span class="line">0xc3db16a8  6500 0000 1300 0000 20f8 e6da 7465 7200  e....... ...ter.</span><br><span class="line">0xc3db16b8  246f dab6 1300 0000 30f8 e6da 7465 7200  $o......0...ter.</span><br><span class="line">0xc3db16c8  6500 0000 2300 0000 4817 dbc3 e186 1a17  e...#...H.......</span><br><span class="line">0xc3db16d8  0937 d4b8 3092 e3c3 0001 0000 3092 e3c3  .7..0.......0...</span><br><span class="line">0xc3db16e8  0080 45c1 1300 0000 d888 1fb7 0000 0000  ..E.............</span><br><span class="line">0xc3db16f8  1000 0000 1300 0000 3ce8 dfb6 3ce8 dfb6  ........&lt;...&lt;...</span><br><span class="line">0xc3db1708  6500 000f 1300 0000 50f8 e6da 7465 7200  e.......P...ter.</span><br><span class="line">0xc3db1718  8403 2900 1b00 0000 3ce8 dfb6 3ce8 dfb6  ..).....&lt;...&lt;...</span><br><span class="line">0xc3db1728  3ce8 dfb6 3ce8 dfb6 f01c fbc2 1300 0000  &lt;...&lt;...........</span><br><span class="line">0xc3db1738  60f8 e6da 7465 7200 0100 0000 2300 0000  `...ter.....#...</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>列出所有已分配内存地址<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> clear</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> \dmal</span><br><span class="line">0xc09622b8	""</span><br><span class="line">0xc3db1648	"hellworld"</span><br><span class="line"></span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>删除所有<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dma-</span><br><span class="line"></span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> \dmal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-2-gt-dtf-trace-function-from-address"><a href="#3-2-gt-dtf-trace-function-from-address" class="headerlink" title="3.2&gt; dtf (trace function from address)"></a>3.2&gt; dtf (trace function from address)</h3><p>例子中，<code>pp</code> 是方法的参数个数和类型；<code>^</code>表示<code>onEnter</code>还是<code>onExit</code>，和<code>Interceptor.attach</code> 的回调一样<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dtf 0xd0c4a143 pp^</span><br><span class="line">true</span><br><span class="line">" 1: 0x1155f251)RACE] dt0xedb88eb9d0c4a1libart.so0: "0��0xb9eb9�0</span><br><span class="line">        0xd0c4a54d      libwbutil.so    0x454d</span><br><span class="line">        0xd0c49d65      libwbutil.so    Java_com_sina_weibo_WeiboApplication_newCalculateS+0x64</span><br><span class="line">        0xd1130b25      base.odex       0xf9b25</span><br><span class="line"></span><br><span class="line">" 1: 0x1155f251)0xd0c4a10xedb88eb9: "0��libart.so       0xb9eb9</span><br><span class="line">        0xd0c4a54d      libwbutil.so    0x454d</span><br><span class="line">        0xd0c49d65      libwbutil.so    Java_com_sina_weibo_WeiboApplication_newCalculateS+0x64</span><br><span class="line">        0xd1130b25      base.odex       0xf9b25</span><br></pre></td></tr></table></figure></p>
<p>… 其他的命令等有空在补充吧，或者自己学习</p>
<h1 id="0x4-Memory"><a href="#0x4-Memory" class="headerlink" title="0x4 Memory"></a>0x4 Memory</h1><p>以Share Weibo为例，<strong>改写</strong>内存数据，是改写，不是写入。<br>首先获取基址<br><code>\dm~wbutil</code> 中的 <code>~</code> 是通配符，如果你不太记得so的文件全名就可以用这个来匹配。<br>其中有 <code>读和执行</code> 权限的那条中的第一个地址 <code>0xcdddc000</code> 是我们要的<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dm~wbutil</span><br><span class="line">0xcdddc000 - 0xcdde8000 r-x /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==/lib/arm/libwbutil.so</span><br><span class="line">0xcdde8000 - 0xcdde9000 r-- /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==/lib/arm/libwbutil.so</span><br><span class="line">0xcdde9000 - 0xcddea000 rw- /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==/lib/arm/libwbutil.so</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>先说下目标；</p>
<blockquote>
<p>需要在 native 方法 <code>newCalculateS</code> 中找到计算出加密字符串 <code>s</code> 的算法</p>
<p>经过分析，在<code>Java_com_sina_weibo_WeiboApplication_newCalculate</code>方法里中的最后是返回的<code>newCalculateS</code>方法；</p>
<p>其中参数1是<code>env指针</code>，参数2是<code>WeiboApplication对象</code>，参数3是<code>uid</code>。</p>
</blockquote>
<p>不过其中还有一大块代码看似没有用到。</p>
<blockquote>
<p>首先是判断0xd0c4有没有数据，这是一个字符串，char*类型。</p>
<p>然后判断0xd0c8，这是一个char。</p>
</blockquote>
<p>下面的方法看了下有点复制，先看 <code>newCalculateS</code> 方法逻辑吧</p>
<p><img src="images/ida_pro_java_newCalculateS_01.png" alt=""></p>
<p>这个方法全貌如图</p>
<p><img src="images/ida_pro_newCalculateS.png" alt=""></p>
<p>整体逻辑是：</p>
<blockquote>
<p>1、通过调用<code>getOriginalString</code>用<code>uid</code>获取<code>key1</code></p>
<p>2、然后通过<code>getKeyString</code>获取<code>key2</code></p>
<p>3、接着通过<code>getIndex</code>将<code>key2</code>处理，返回一个<code>jintArray</code>对象</p>
<p>4、然后通过这个<code>jintArray</code>对象从<code>key1</code>中获取对应索引的字符，并使用java的<code>StringBuilder</code>拼接成<code>jstring</code>对象</p>
</blockquote>
<h2 id="0x4-1-getOriginalString"><a href="#0x4-1-getOriginalString" class="headerlink" title="0x4.1 getOriginalString"></a>0x4.1 getOriginalString</h2><p>这个方法如图所示</p>
<p><img src="images/ida_pro_getOriginalString.png" alt=""></p>
<p>很简单的几行代码，难处在<code>g_pin</code>和<code>g_from</code>这两个变量；</p>
<p>可能刚打开到这个方法<code>CallObjectMethod</code>只有三个参数，并没有第四个参数；</p>
<p>这里就是拼接字符串，<code>g_pin + uid + g_from</code>；</p>
<p>我们需要找到g_pin和g_from，这里可以先用下面的代码hook一下看看是什么东西；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">"libwbutil.so"</span>, <span class="string">"_ZN7_JNIEnv16CallObjectMethodEP8_jobjectP10_jmethodIDz"</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="keyword">var</span> <span class="built_in">String</span> = Java.use(<span class="string">"java.lang.String"</span>);</span><br><span class="line">           <span class="keyword">var</span> ret = Java.cast(ptr(args[<span class="number">3</span>]), <span class="built_in">String</span>);</span><br><span class="line">           <span class="built_in">console</span>.warn(<span class="string">"CallObjectMethod("</span>.concat(args[<span class="number">0</span>])</span><br><span class="line">                            + <span class="string">", "</span>.concat(args[<span class="number">1</span>])</span><br><span class="line">                            + <span class="string">", "</span>.concat(args[<span class="number">2</span>])</span><br><span class="line">                            + <span class="string">", "</span>.concat(ret) + <span class="string">")"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CallObjectMethod(0xccb76780, 0x119, 0x70dd9e70, 5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo)</span><br><span class="line">CallObjectMethod(0xccb76780, 0x119, 0x70dd9e70, 73586191xx)</span><br><span class="line">CallObjectMethod(0xccb76780, 0x119, 0x70dd9e70, 109C0950xx)</span><br></pre></td></tr></table></figure></p>
<p>然后就是将拼接好的字符串进行<code>sha512</code>加密并返回</p>
<h2 id="0x4-2-getKeyString"><a href="#0x4-2-getKeyString" class="headerlink" title="0x4.2 getKeyString"></a>0x4.2 getKeyString</h2><p>反编译如下</p>
<p><img src="images/ida_pro_getKeyString.png" alt=""></p>
<p>这里只append了<code>g_from</code>，然后用<code>sha512</code>加密后返回</p>
<h2 id="0x4-3-getIndex"><a href="#0x4-3-getIndex" class="headerlink" title="0x4.3 getIndex"></a>0x4.3 getIndex</h2><p><img src="images/ida_pro_getIndex.png" alt=""></p>
<p>这里稍微复杂点的就是do while；前面是将十六进制的key2转为bytearray</p>
<p>在do while里</p>
<blockquote>
<p>1、首先从bytearray里取内容，索引是v10；然后将其转为int</p>
<p>2、然后将索引v10与转换后的byte相加，转而变成新索引</p>
<p>3、v9自增4</p>
<p>4、当v9 == 32结束while</p>
</blockquote>
<p>这里一共处理了8次，也就是最后的数据是长度为8</p>
<p>所以下面new了一个长度为8的int数组，然后把数据复制到里面，然后返回</p>
<h2 id="0x4-4-g-pin、g-from"><a href="#0x4-4-g-pin、g-from" class="headerlink" title="0x4.4 g_pin、g_from"></a>0x4.4 g_pin、g_from</h2><p>回到最初到哪个<code>newCalculateS</code>方法，这里有个 app_setPin 方法很可疑，而且它的第二参数和上面的那串字符串参数的方法有关。</p>
<p>这个方法就是把 a2 设置为 <code>g_pin</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall app_setPin(int result, int a2)</span><br><span class="line">&#123;</span><br><span class="line">  if ( !g_pin )</span><br><span class="line">  &#123;</span><br><span class="line">    result = _JNIEnv::NewGlobalRef(result, a2);</span><br><span class="line">    g_pin = result;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而这个a2是sub_451C方法返回的内容经过new转为jstring的；所以只要解决这个方法就行了。</p>
<p>这个方法的第三个参数是十六进制字符串，不清楚是什么。我们可以hook看看返回值是什么<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function sh(a, s)&#123;console.error(hexdump(ptr(String(a)),&#123;offset:0,length:s,header:true,ansi:false&#125;))&#125;</span><br><span class="line">var base = Module.getBaseAddress("libwbutil.so");</span><br><span class="line">Interceptor.attach(ptr(base.add(0x451c+1)), &#123;</span><br><span class="line">    onLeave: function(retval) &#123;</span><br><span class="line">        console.log('\n');</span><br><span class="line">        sh(retval, 64); // hexdump</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>不出意外的话什么都没输出，应该是没调用。</p>
<p>首先看看最先判断的那个变量是什么玩意儿，这里用r2frida会特别方便；</p>
<p>先用dm命令获取基址，然后通过px命令获取内存十六进制输出；可以看到是个地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> \dm~wbutil</span><br><span class="line">0xcddd0000 - 0xcdddc000 r-x /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==/lib/arm/libwbutil.so</span><br><span class="line">0xcdddc000 - 0xcdddd000 r-- /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==/lib/arm/libwbutil.so</span><br><span class="line">0xcdddd000 - 0xcddde000 rw- /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==/lib/arm/libwbutil.so</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> px @ 0xcddd0000+0xd0c4</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xcdddd0c4  70dc 10e5 0100 0000 0000 0000 0000 0000  p...............</span><br><span class="line">0xcdddd0d4  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd0e4  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd0f4  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd104  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd114  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd124  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd134  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd144  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd154  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd164  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd174  0000 0000 0000 0000 0000 0000 c243 0000  .............C..</span><br><span class="line">0xcdddd184  a247 0000 0000 0000 0000 0000 0000 0000  .G..............</span><br><span class="line">0xcdddd194  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd1a4  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line">0xcdddd1b4  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure>
<p>而这个地址的内容恰好是和上面的g_pin内容一样<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> x @ 0xe510dc70</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xe510dc70  356c 3057 586e 6869 5934 704a 3739 344b  5l0WXnhiY4pJ794K</span><br><span class="line">0xe510dc80  494a 3752 7735 4634 3556 5867 3973 6a6f  IJ7Rw5F45VXg9sjo</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>不过这个地址貌似一直都有东西，所以首个if会不成立，直接调用 <code>newCalculateS</code>；</p>
<p>这里可以尝试改指令，把指令直接改成BEQ，不过这样做会运行一会就闪退，所以这里我卡了一点时间，不过好在<code>radare2</code> 能改内存数据，而 <code>frida</code> 加上这个功能基本可以和 <code>ida</code> 刚了，我还觉得比ida好用。</p>
</blockquote>
<p>这里用r2的<code>wx</code>命令就能修改</p>
<p>help:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> wx?</span><br><span class="line">Usage: wx[f] [arg]  </span><br><span class="line">| wx 9090     write two intel nops</span><br><span class="line">| wxf -|file  write contents of hexpairs file here</span><br><span class="line">| wxs 9090    write hexpairs and seek at the end</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>修改为0<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[0x00000000]&gt;</span> x 16 @ 0xcddd0000+0xd0c4</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xcdddd0c4  a897 a1cb 0100 0000 0000 0000 0000 0000  ................</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> wx 000000000000 @ 0xcddd0000+0xd0c4</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span> x 16 @ 0xcddd0000+0xd0c4</span><br><span class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</span><br><span class="line">0xcdddd0c4  0000 0000 0000 0000 0000 0000 0000 0000  ................</span><br><span class="line"><span class="meta">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后再hook一次<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">c768dd98  35 6c 30 57 58 6e 68 69 59 34 70 4a 37 39 34 4b  5l0WXnhiY4pJ794K</span><br><span class="line">c768dda8  49 4a 37 52 77 35 46 34 35 56 58 67 39 73 6a 6f  IJ7Rw5F45VXg9sjo</span><br><span class="line">c768ddb8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">c768ddc8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br></pre></td></tr></table></figure></p>
<p>可以看到返回值就是g_from，既然不知道dword_D0C4是从哪赋值的那就自己生成吧</p>
<h2 id="0x4-5-sub-451C"><a href="#0x4-5-sub-451C" class="headerlink" title="0x4.5 sub_451C"></a>0x4.5 sub_451C</h2><p><img src="images/ida_pro_sub_451c.png" alt=""></p>
<p>这里有几个方法的调用，先不管，统统hook一遍；hook之前记得把<code>dword_D0C4</code>地址内容置00</p>
<p><code>sub_4142</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base = Module.getBaseAddress(<span class="string">"libwbutil.so"</span>);</span><br><span class="line">Interceptor.attach(ptr(base.add(<span class="number">0x4124</span>+<span class="number">1</span>)), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'\n'</span>);</span><br><span class="line">        sh(retval, <span class="number">64</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>output:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">c5f4f140  37 30 34 65 36 63 31 62 00 00 6f 00 0a 16 00 00  704e6c1b..o.....</span><br><span class="line">c5f4f150  61 73 73 65 74 73 2f 63 66 67 2e 6a 73 6f 6e 00  assets/cfg.json.</span><br><span class="line">c5f4f160  2e 64 65 62 75 67 5f 6c 69 6e 65 00 01 00 00 00  .debug_line.....</span><br><span class="line">c5f4f170  2e 64 65 62 75 67 5f 6c 69 6e 65 00 67 73 00 00  .debug_line.gs..</span><br></pre></td></tr></table></figure></p>
<p><code>mbedtls_decode</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">"libwbutil.so"</span>, <span class="string">"mbedtls_decode"</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'\n'</span>)</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">'mbedtls_decode('</span>.concat(Memory.readCString(args[<span class="number">0</span>]))</span><br><span class="line">                    + <span class="string">", "</span>.concat(args[<span class="number">1</span>])</span><br><span class="line">                    + <span class="string">", "</span>.concat(args[<span class="number">2</span>])</span><br><span class="line">                    + <span class="string">", "</span>.concat(args[<span class="number">3</span>]) + <span class="string">")"</span>);</span><br><span class="line">        sh(args[<span class="number">2</span>], <span class="number">16</span>);</span><br><span class="line">        sh(args[<span class="number">3</span>], <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>output:</p>
<p><img src="images/frida_mbedtls_decode_output.png" alt=""></p>
<p>经过hook + 分析后可以断定这个方法的作用就是为了解密那串十六进制字符串；</p>
<p>在<code>mbedtls_decode</code>方法中有一个行代码是des解密，使用的是mbedtls_des_crypt_ecb，这个方法在google一搜就能找到对应的<a href="https://tls.mbed.org/api/des_8h.html" target="_blank" rel="noopener">doc</a>，好像是mbedtls库里的一个方法，这个库没用过所以不熟悉。</p>
<p>从api解释可以看出这是一个des ecb模式加解密方法</p>
<p><img src="images/mbedtls_des_crypt_ecb_doc.png" alt=""></p>
<blockquote>
<p>第一个参数是des的上下文;</p>
<p>第二个参数是8个字节(64bit)的输入;</p>
<p>第三个参数是8个字节(64bit)的输出;</p>
</blockquote>
<p>是解密还是加密可以从上面的 <code>mbedtls_des_setkey_dec</code> 猜到，这是解密</p>
<p><img src="images/mbedtls_des_setkey_dec_doc.png" alt=""></p>
<p>那就需要获取到这个key了，从上图可以看出第二个参数就是key<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">"libwbutil.so"</span>, <span class="string">"mbedtls_des_setkey_dec"</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        sh(args[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>output:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">           0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">cea66290  37 30 34 65 36 63 31 62 00 a5 e0 46 d9 fc a6 bd  704e6c1b...F....</span><br></pre></td></tr></table></figure></p>
<p>des的key长度是8个字节，所以key是<code>704e6c1b</code></p>
<p>有了key知道模式就很简单了。</p>
<h1 id="0x5-算法还原"><a href="#0x5-算法还原" class="headerlink" title="0x5 算法还原"></a>0x5 算法还原</h1><p>4种语言总有看得懂的把</p>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java:"></a>Java:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.lang.StringBuilder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] TEMP = <span class="string">"0123456789ABCDEF"</span>.toCharArray();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY2 = <span class="string">"109C195010"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UID = <span class="string">"7358119308"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY1 = <span class="string">"5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo"</span> + UID + KEY2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        String key2_s = sha512(KEY2).toLowerCase();</span><br><span class="line">        String key1_s = sha512(KEY1).toLowerCase();</span><br><span class="line">        System.out.println(<span class="string">"KEY1:"</span> + key1_s + <span class="string">"("</span> + KEY1 + <span class="string">")"</span>);</span><br><span class="line">        System.out.println(<span class="string">"KEY2:"</span> + key2_s + <span class="string">"("</span> + KEY2 + <span class="string">")"</span>);</span><br><span class="line">        <span class="keyword">char</span> bytes[] = key2_s.toCharArray();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            k = converByte2Int(bytes[j]);</span><br><span class="line">            System.out.println(k);</span><br><span class="line">            j += k;</span><br><span class="line">            sb.append(key1_s.charAt(j));</span><br><span class="line">            i += <span class="number">4</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (i!=<span class="number">32</span>);</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">converByte2Int</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a - <span class="number">48</span> &lt;= <span class="number">9</span>) <span class="keyword">return</span> a - <span class="number">48</span>;</span><br><span class="line">        <span class="keyword">if</span> (a - <span class="number">65</span> &gt; <span class="number">5</span>) <span class="keyword">return</span> a - <span class="number">87</span>;</span><br><span class="line">        <span class="keyword">return</span> a - <span class="number">55</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sha512</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest sha512 = MessageDigest.getInstance(<span class="string">"SHA-512"</span>);</span><br><span class="line">            sha512.update(text.getBytes());</span><br><span class="line">            String ret = bytes2hex(sha512.digest());</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bytes2hex</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] hexChars = <span class="keyword">new</span> <span class="keyword">char</span>[bytes.length * <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; bytes.length; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = bytes[j] &amp; <span class="number">0xFF</span>;</span><br><span class="line">            hexChars[j * <span class="number">2</span>] = TEMP[v&gt;&gt;<span class="number">4</span>];</span><br><span class="line">            hexChars[j * <span class="number">2</span> + <span class="number">1</span>] = TEMP[v&amp;<span class="number">0x0f</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(hexChars);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Golang"><a href="#Golang" class="headerlink" title="Golang:"></a>Golang:</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"crypto/sha512"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> KEY = <span class="string">"5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo"</span></span><br><span class="line"><span class="keyword">var</span> UID = <span class="string">"1014653719052"</span></span><br><span class="line"><span class="keyword">var</span> KEY2 = <span class="string">"109A395010"</span></span><br><span class="line"><span class="keyword">var</span> KEY1 = KEY + UID + KEY2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">enSha512</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%x"</span>, sha512.Sum512([]<span class="keyword">byte</span>(text)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getIndex</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> ret <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> j <span class="keyword">int</span></span><br><span class="line">    bytes := []<span class="keyword">byte</span>(text)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ &#123;</span><br><span class="line">        k := converByte2Int(<span class="keyword">int</span>(bytes[j]))</span><br><span class="line">        j += k</span><br><span class="line">        ret += fmt.Sprintf(<span class="string">"%x"</span>, k)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">converByte2Int</span><span class="params">(b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">48</span> &lt;= <span class="number">9</span> &#123; <span class="keyword">return</span> b - <span class="number">48</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">65</span> &gt; <span class="number">5</span> &#123; <span class="keyword">return</span> b - <span class="number">87</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> b - <span class="number">55</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    key1_s := enSha512(KEY1)</span><br><span class="line">    key2_s := enSha512(KEY2)</span><br><span class="line">    fmt.Printf(<span class="string">"key1: %s(%s)\n"</span>, key1_s, KEY1)</span><br><span class="line">    fmt.Printf(<span class="string">"key2: %s(%s)\n"</span>, key2_s, KEY2)</span><br><span class="line">    <span class="comment">// key2_s byte array</span></span><br><span class="line">    k2si_ba := getIndex(key2_s)</span><br><span class="line">    <span class="keyword">var</span> result <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> j <span class="keyword">uint64</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> k2si_ba &#123;</span><br><span class="line">        index, _ := strconv.ParseUint(<span class="keyword">string</span>(k2si_ba[i]), <span class="number">16</span>, <span class="number">32</span>)</span><br><span class="line">        j += index</span><br><span class="line">        result += <span class="keyword">string</span>(key1_s[j])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">"s: "</span>, result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="C-（sha512-h太长了，直接去github下载把）"><a href="#C-（sha512-h太长了，直接去github下载把）" class="headerlink" title="C++（sha512.h太长了，直接去github下载把）:"></a>C++（<code>sha512.h太长了，直接去github下载把</code>）:</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sha512.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> UID = <span class="string">"5715174600"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> FROM = <span class="string">"109C295010"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> KEY = <span class="string">"5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo"</span> + UID + FROM;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">converByte2Int</span><span class="params">(<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b - <span class="number">48</span> &lt;= <span class="number">9</span>) <span class="keyword">return</span> b - <span class="number">48</span>;</span><br><span class="line">    <span class="keyword">if</span> (b - <span class="number">64</span> &gt; <span class="number">5</span>) <span class="keyword">return</span> b - <span class="number">87</span>;</span><br><span class="line">    <span class="keyword">return</span> b - <span class="number">55</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> k_s = sha512::calculate(KEY);</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> f_s = sha512::calculate(FROM);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        k = converByte2Int(<span class="keyword">int</span>(f_s[i]));</span><br><span class="line">        i += k;</span><br><span class="line">        j += <span class="number">4</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; k_s[i];</span><br><span class="line">    &#125; <span class="keyword">while</span>(j != <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python:"></a>Python:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEY2 = <span class="string">"109A395010"</span></span><br><span class="line">UID = <span class="string">"1014653719052"</span></span><br><span class="line">KEY1 = <span class="string">"5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo%s%s"</span> % (UID, KEY2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">converByte2Int</span><span class="params">(b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">48</span> &lt;= <span class="number">9</span>: <span class="keyword">return</span> b - <span class="number">48</span></span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">65</span> &gt; <span class="number">5</span>: <span class="keyword">return</span> b - <span class="number">87</span></span><br><span class="line">    <span class="keyword">return</span> a - <span class="number">55</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    key1_s = hashlib.sha512(KEY1.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">    key2_s = hashlib.sha512(KEY2.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">    print(<span class="string">f"KEY1: <span class="subst">&#123;key1_s&#125;</span> (<span class="subst">&#123;KEY1&#125;</span>)"</span>)</span><br><span class="line">    print(<span class="string">f"KEY2: <span class="subst">&#123;key2_s&#125;</span> (<span class="subst">&#123;KEY2&#125;</span>)"</span>)</span><br><span class="line">    ret = <span class="string">""</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        k = converByte2Int(ord(key2_s[j]))</span><br><span class="line">        j += k</span><br><span class="line">        ret += key1_s[j]</span><br><span class="line">    print(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><ul>
<li>项目地址：<a href="https://github.com/ZCKun/Weibo" target="_blank" rel="noopener">https://github.com/ZCKun/Weibo</a></li>
<li>WebSite: <a href="http://2h0n9.com/" target="_blank" rel="noopener">2h0n9</a></li>
<li>WeChat公众号: the2h0Ng</li>
<li>WeChat: zlztxwd</li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#正文"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-安装"><span class="toc-number">2.1.</span> <span class="toc-text">0x1 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-使用"><span class="toc-number">2.2.</span> <span class="toc-text">0x2 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-1-gt-help"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">0x2.1&gt; help</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-2-gt-dm"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">0x2.2&gt; dm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-3-gt-iE"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">0x2.3&gt; iE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-24-gt"><span class="toc-number">2.2.0.4.</span> <span class="toc-text">0x.24&gt; \/</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-Dynamic"><span class="toc-number">2.3.</span> <span class="toc-text">0x3 Dynamic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x3-1-gt-dma"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">0x3.1&gt; dma</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-gt-dtf-trace-function-from-address"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.2&gt; dtf (trace function from address)</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#0x4-Memory"><span class="toc-number">3.</span> <span class="toc-text">0x4 Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-1-getOriginalString"><span class="toc-number">3.1.</span> <span class="toc-text">0x4.1 getOriginalString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-2-getKeyString"><span class="toc-number">3.2.</span> <span class="toc-text">0x4.2 getKeyString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-3-getIndex"><span class="toc-number">3.3.</span> <span class="toc-text">0x4.3 getIndex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-4-g-pin、g-from"><span class="toc-number">3.4.</span> <span class="toc-text">0x4.4 g_pin、g_from</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-5-sub-451C"><span class="toc-number">3.5.</span> <span class="toc-text">0x4.5 sub_451C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x5-算法还原"><span class="toc-number">4.</span> <span class="toc-text">0x5 算法还原</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">4.0.1.</span> <span class="toc-text">Java:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Golang"><span class="toc-number">4.0.2.</span> <span class="toc-text">Golang:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-（sha512-h太长了，直接去github下载把）"><span class="toc-number">4.0.3.</span> <span class="toc-text">C++（sha512.h太长了，直接去github下载把）:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">4.0.4.</span> <span class="toc-text">Python:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最后"><span class="toc-number">5.</span> <span class="toc-text">最后</span></a></li>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&text=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&is_video=false&description=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&body=Check out this article: http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&name=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 0x2h
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?b1bcce32f51ad876ecf02282881e609b";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


</body>
</html>
